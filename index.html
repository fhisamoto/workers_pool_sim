<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
  <script src="http://code.jquery.com/jquery.js"></script>
  <script src="bootstrap/js/bootstrap.min.js"></script>
  <script src="worker_pool.js"></script>
</head>
<body>
  <div class="container">
    <p>
      <button id="create-jobs" class="btn btn-large btn-primary" type="button">Create Jobs</button>
    </p>
    <input id="pAvg" type="text" class="input-small" placeholder="avg">
    <input id="pStd" type="text" class="input-small" placeholder="std"><br>
    <input id="avg" type="text" class="input-small" placeholder="avg">
    <input id="std" type="text" class="input-small" placeholder="std">
    <input id="jobs" type="text" class="input-small" placeholder="num jobs">
    <div id="chart_container">
      <div id="chart"></div>
    </div>
    <div id="legend"></div><br>
    <div id="sim_bars" style="width:400px"></div>
  </div>
</body>

<script>
    $(function() {
        var pool = new WorkersPool({ numWorkers: 30 });
        pool.workers.forEach(function(worker) {
            var progressBar = '<div class="progress progress-info progress-striped"><div id="' + worker.workerId + '" class="bar" style="width:0%"></div></div>';
            $('#sim_bars').append(progressBar);
        });
        
        $("#create-jobs").on('click', function(){
            setInterval(function() { 
                for(var i = 0; i < 25; i++) { pool.addJob(new Job()); } 
            }, 100);

            var summary = null;
            var lastSummary = null;
            setInterval(function(){
              summary = pool.summarize();
              if (lastSummary !== null) {
                var diffSummary = new Summary(summary.numJobs - lastSummary.numJobs,
                  summary.totalTime - lastSummary.totalTime,
                  summary.totalTime2 - lastSummary.totalTime2
                );
                $('#pAvg').val(diffSummary.average());
                $('#pStd').val(diffSummary.standardDeviation());
              }
              $('#jobs').val(summary.numJobs);
              $('#avg').val(summary.average());
              $('#std').val(summary.standardDeviation());
              lastSummary = summary;
            }, 1000);
        });
    })
</script>

</html>
